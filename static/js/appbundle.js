var hedyApp=(()=>{var A=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var J=A(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.modal=D.error=void 0;var Te=function(){function e(){var t=this;$("#modal-confirm-button").on("click",function(){return t.hide()}),$("#modal-no-button").on("click",function(){return t.hide()}),$("#modal-cancel-button").on("click",function(){return t.hide()})}return e.prototype.show=function(){$("#modal-mask").show(),$("#modal-content").show(),window.scrollTo(0,0)},e.prototype.hide=function(){$("#modal-mask").hide(),$("#modal-content").hide(),$("#modal-alert").hide(),$("#modal-prompt").hide(),$("#modal-confirm").hide()},e.prototype.alert=function(t,r){var o=this;$("#modal-alert-text").text(t),this.show(),$("#modal-alert").show(),r&&setTimeout(function(){return o.hide()},r)},e.prototype.confirm=function(t,r){var o=this;$("#modal-confirm-text").text(t),this.show(),$("#modal-confirm").show(),$("#modal-yes-button").off("click").on("click",function(){o.hide(),r()})},e.prototype.prompt=function(t,r,o){var s=this;$("#modal-prompt-text").text(t),this.show(),$("#modal-prompt").show(),r&&$("#modal-prompt-input").val(r),$("#modal-ok-button").off("click").on("click",function(){s.hide();var a=$("#modal-prompt-input").val();typeof a=="string"&&o(a)})},e}(),I;D.error={setEditor:function(e){I=e},hide:function(){$("#errorbox").hide(),$("#warningbox").hide(),I==null||I.resize()},showWarning:function(e,t){$("#warningbox .caption").text(e),$("#warningbox .details").text(t),$("#warningbox").show(),I==null||I.resize()},show:function(e,t){$("#errorbox .caption").text(e),$("#errorbox .details").html(t),$("#errorbox").show(),I==null||I.resize()}};D.modal=new Te});var ee=A(()=>{"use strict";function m(){return{gobble:[{regex:".*",token:"text",next:"start"}],expression_eol:Ee([{regex:"'[^']*'",token:"constant.character"},{regex:"at random",token:"keyword"},{regex:"$",token:"text"}])}}var Me=[{name:"level1",rules:g(m(),P("gobble"),Z(),p("start",{regex:R("echo"),token:"keyword",next:"gobble"}),p("start",{regex:R("ask"),token:"keyword",next:"gobble"}))},{name:"level2",rules:g(m(),P("expression_eol"),j("gobble"),v("gobble"),Z())},{name:"level3",rules:g(m(),Z(),P("expression_eol"),j(),v())},{name:"level4",rules:g(m(),P(),j(),v(),Y(),w())},{name:"level5",rules:g(m(),P(),j(),v(),Y(),w(),Q())},{name:"level6",rules:g(m(),P(),j(),v(),Y(),w(),Q(),y())},{name:"level7",rules:g(m(),P(),j(),v(),x(),w(),Q(),y())},{name:"level8",rules:g(m(),P(),j(),v(),x(),w(),y(),oe())},{name:"level9and10",rules:g(m(),P(),j(),v(),x(),w(),y(),ie(),oe())},{name:"level11",rules:g(m(),P(),j(),v(),x(),w(),y(),ie())},{name:"level12",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level11",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level13",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level14",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level15",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level16",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level17",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level18and19",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level20",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level21",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level22",rules:g(m(),k(),T(),v(),x(),w(),y(),M())},{name:"level23",rules:g(m(),k(),T(),v(),x(),w(),y(),M())}];function Ee(e){for(var t=[],r=0,o=e;r<o.length;r++){var s=o[r];s.regex&&t.push({regex:s.regex+"$",token:s.token,next:"start"}),t.push(s)}return t}function p(e,t){return function(r){var o;Array.isArray(e)||(e=[e]);for(var s=0,a=e;s<a.length;s++){var i=a[s];r[i]||(r[i]=[]),Array.isArray(t)?(o=r[i]).push.apply(o,t):r[i].push(t)}return r}}function U(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){for(var o=0,s=e;o<s.length;o++){var a=s[o];r=a(r)}return r}}function g(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return U.apply(void 0,t)(e)}function P(e){return p("start",{regex:R("print"),token:"keyword",next:e!=null?e:"start"})}function j(e){return p("start",{regex:"(\\w+)( is ask )",token:["text","keyword"],next:e!=null?e:"expression_eol"})}function v(e){return p("start",{regex:"(\\w+)( is )",token:["text","keyword"],next:e!=null?e:"expression_eol"})}function k(){return p("start",{regex:"(print)(\\()",token:["keyword","paren.lparen"],next:"start"})}function Z(){return U(p("start",{regex:"turn (left|right)?",token:"keyword",next:"start"}),p("start",{regex:"forward",token:"keyword",next:"start"}))}function T(){return p("start",{regex:"(\\w+)( is input)(\\()",token:["text","keyword","paren.lparen"],next:"start"})}function w(){return U(p("start",{regex:"'[^']*'",token:"constant.character"}),p("start",{regex:"at random",token:"keyword"}),p("start",{regex:"[, ]+",token:"punctuation.operator"}))}function Y(){return U(p("start",{regex:R("if"),token:"keyword",next:"condition"}),p("start",{regex:R("else"),token:"keyword"}),p("condition",{regex:R("is"),token:"keyword",next:"start"}))}function x(){return U(p("start",{regex:R("if"),token:"keyword",next:"condition"}),p("start",{regex:"\\belse\\b",token:"keyword"}),p("condition",{regex:R("((is)|(in))"),token:"keyword",next:"start"}))}function y(){return p(["start","expression_eol"],[{regex:" \\* ",token:"keyword"},{regex:" \\+ ",token:"keyword"},{regex:" \\- ",token:"keyword"}])}function Q(){return p("start",{regex:"(repeat)( \\w+ )(times)",token:["keyword","text","keyword"]})}function oe(){return p("start",{regex:"(for )(\\w+)( in )(\\w+)",token:["keyword","text","keyword","text"]})}function ie(){return p("start",{regex:"(for )(\\w+)( in range )(\\w+)( to )(\\w+)",token:["keyword","text","keyword","text","keyword","text"]})}function M(){return p("start",{regex:"(for )(\\w+)( in range)(\\()([\\s\\w]+)(,)([\\s\\w]+)(\\))",token:["keyword","text","keyword","paren.lparen","text","punctuation.operator","text","paren.rparen"]})}function Ce(e){for(var t=0,r=Object.values(e);t<r.length;t++)for(var o=r[t],s=0,a=o;s<a.length;s++){var i=a[s];i.regex&&!i._loosened&&(i.regex=i.regex.replace(/ /g," +"),i._loosened=!0)}return e}if(window.define)for(se=function(e){define("ace/mode/"+e.name,[],function(t,r,o){var s=t("ace/lib/oop"),a=t("ace/mode/text").Mode,i=t("ace/mode/text_highlight_rules").TextHighlightRules;function d(){this.$rules=Ce(e.rules),this.normalizeRules()}s.inherits(d,i);function u(){this.HighlightRules=d}s.inherits(u,a),r.Mode=u})},K=0,X=Me;K<X.length;K++)ue=X[K],se(ue);var se,ue,K,X;function R(e){return"\\b"+e+" "}});var te=A(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.remove_student=E.join_class=E.delete_class=E.rename_class=E.create_class=void 0;var C=J(),N=V();function Ie(){C.modal.prompt(N.auth.texts.class_name_prompt,"",function(e){$.ajax({type:"POST",url:"/class",data:JSON.stringify({name:e}),contentType:"application/json",dataType:"json"}).done(function(t){location.reload()}).fail(function(t){console.error(t),C.error.show(ErrorMessages.Connection_error,JSON.stringify(t))})})}E.create_class=Ie;function Pe(e){C.modal.prompt(N.auth.texts.class_name_prompt,"",function(t){$.ajax({type:"PUT",url:"/class/"+e,data:JSON.stringify({name:t}),contentType:"application/json",dataType:"json"}).done(function(r){location.reload()}).fail(function(r){console.error(r),C.error.show(ErrorMessages.Connection_error,JSON.stringify(r))})})}E.rename_class=Pe;function Ge(e){C.modal.confirm(N.auth.texts.delete_class_prompt,function(){$.ajax({type:"DELETE",url:"/class/"+e,contentType:"application/json",dataType:"json"}).done(function(t){window.location.pathname="/for-teachers"}).fail(function(t){console.error(t),C.error.show(ErrorMessages.Connection_error,JSON.stringify(t))})})}E.delete_class=Ge;function je(e,t,r){if(r===void 0&&(r=!1),!N.auth.profile)return C.modal.confirm(N.auth.texts.join_prompt,function(){localStorage.setItem("hedy-join",JSON.stringify({link:e,name:t})),window.location.pathname="/login"});$.ajax({type:"GET",url:e}).done(function(o){C.modal.alert(N.auth.texts.class_join_confirmation+" "+t),r||(window.location.pathname="/programs")}).fail(function(o){console.error(o),C.error.show(ErrorMessages.Connection_error,JSON.stringify(o))})}E.join_class=je;function Oe(e,t){C.modal.confirm(N.auth.texts.remove_student_prompt,function(){$.ajax({type:"DELETE",url:"/class/"+e+"/student/"+t,contentType:"application/json",dataType:"json"}).done(function(r){location.reload()}).fail(function(r){console.error(r),C.error.show(ErrorMessages.Connection_error,JSON.stringify(r))})})}E.remove_student=Oe});var V=A(n=>{"use strict";var Ae=n&&n.__awaiter||function(e,t,r,o){function s(a){return a instanceof r?a:new r(function(i){i(a)})}return new(r||(r=Promise))(function(a,i){function d(c){try{l(o.next(c))}catch(_){i(_)}}function u(c){try{l(o.throw(c))}catch(_){i(_)}}function l(c){c.done?a(c.value):s(c.value).then(d,u)}l((o=o.apply(e,t||[])).next())})},Re=n&&n.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},o,s,a,i;return i={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function d(l){return function(c){return u([l,c])}}function u(l){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,s&&(a=l[0]&2?s.return:l[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,l[1])).done)return a;switch(s=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(l[0]===6&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],s=0}finally{o=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});n.auth=void 0;var L=J(),Ne=te(),Le=W(),le={AF:"Afghanistan",AX:"\xC5land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia, Plurinational State of",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, the Democratic Republic of the",CK:"Cook Islands",CR:"Costa Rica",CI:"C\xF4te d'Ivoire",HR:"Croatia",CU:"Cuba",CW:"Cura\xE7ao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, the Former Yugoslav Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"R\xE9union",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barth\xE9lemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan, Province of China",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};n.auth={texts:AuthMessages,profile:void 0,reset:void 0,entityify:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},emailRegex:/^(([a-zA-Z0-9_+\.\-]+)@([\da-zA-Z\.\-]+)\.([a-zA-Z\.]{2,6})\s*)$/,redirect:function(e){e="/"+e,window.location.pathname=e},logout:function(){$.ajax({type:"POST",url:"/auth/logout"}).done(function(){n.auth.redirect("login")})},destroy:function(){L.modal.confirm(n.auth.texts.are_you_sure,function(){$.ajax({type:"POST",url:"/auth/destroy"}).done(function(){n.auth.redirect("")})})},error:function(e,t,r){$(r||"#error").html(e),$(r||"#error").css("display","block"),t&&$("#"+t).css("border","solid 1px red")},clear_error:function(e){$(e||"#error").html(""),$(e||"#error").css("display","none"),$("form *").css("border","")},success:function(e,t){$("#error").css("display","none"),$(t||"#success").html(e),$(t||"#success").css("display","block")},submit:function(e){var t,r,o,s,a={};if($("form.auth *").map(function(d,u){u.id&&(a[u.id]=u.value)}),e==="signup"){if(!a.username)return n.auth.error(n.auth.texts.please_username,"username");if(a.username=a.username.trim(),a.username.length<3)return n.auth.error(n.auth.texts.username_three,"username");if(a.username.match(/:|@/))return n.auth.error(n.auth.texts.username_special,"username");if(!((t=a.email)===null||t===void 0?void 0:t.match(n.auth.emailRegex)))return n.auth.error(n.auth.texts.valid_email,"email");if(a.email!==a.mail_repeat)return n.auth.error(n.auth.texts.repeat_match_email,"mail_repeat");if(!a.password)return n.auth.error(n.auth.texts.please_password,"password");if(a.password.length<6)return n.auth.error(n.auth.texts.password_six,"password");if(a.password!==a.password_repeat)return n.auth.error(n.auth.texts.repeat_match_password,"password_repeat");if(a.birth_year&&!he(a.birth_year))return n.auth.error(n.auth.texts.valid_year+new Date().getFullYear(),"birth_year");var i={username:a.username,email:a.email,password:a.password,birth_year:a.birth_year?parseInt(a.birth_year):void 0,country:a.country?a.country:void 0,gender:a.gender?a.gender:void 0,subscribe:$("#subscribe").prop("checked"),prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map(function(d,u){return $(u).val()}).get():void 0};$.ajax({type:"POST",url:"/auth/signup",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){n.auth.success(n.auth.texts.signup_success),n.auth.profile={session_expires_at:Date.now()+1e3*60*60*24},ce()}).fail(function(d){var u=d.responseText||"";u.match("email")?n.auth.error(n.auth.texts.exists_email):u.match("username")?n.auth.error(n.auth.texts.exists_username):n.auth.error(n.auth.texts.ajax_error)})}if(e==="login"){if(!a.username)return n.auth.error(n.auth.texts.please_username_email,"username");if(!a.password)return n.auth.error(n.auth.texts.please_password,"password");n.auth.clear_error(),$.ajax({type:"POST",url:"/auth/login",data:JSON.stringify({username:a.username,password:a.password}),contentType:"application/json; charset=utf-8"}).done(function(){n.auth.profile={session_expires_at:Date.now()+1e3*60*60*24},ce()}).fail(function(d){var u;d.status===403?(n.auth.error(n.auth.texts.invalid_username_password+" "+n.auth.texts.no_account+` &nbsp;<button class="green-btn" onclick="auth.redirect ('signup')">`+n.auth.texts.create_account+"</button>"),$("#create-account").hide(),localStorage.setItem("hedy-login-username",(u=a.username)!==null&&u!==void 0?u:"")):n.auth.error(n.auth.texts.ajax_error)})}if(e==="profile"){if(!((r=a.email)!==null&&r!==void 0?r:"").match(n.auth.emailRegex))return n.auth.error(n.auth.texts.valid_email,"email");if(a.birth_year&&!he(a.birth_year))return n.auth.error(n.auth.texts.valid_year+new Date().getFullYear(),"birth_year");var i={email:a.email,birth_year:a.birth_year?parseInt(a.birth_year):void 0,country:a.country,gender:a.gender,prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map(function(u,l){return $(l).val()}).get():void 0};console.log(i),n.auth.clear_error(),$.ajax({type:"POST",url:"/profile",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){n.auth.success(n.auth.texts.profile_updated)}).fail(function(u){n.auth.error(n.auth.texts.ajax_error+" "+u.responseText)})}if(e==="change_password"){if(!a.password)return n.auth.error(n.auth.texts.please_password,"password","#error-password");if(a.password.length<6)return n.auth.error(n.auth.texts.password_six,"password","#error-password");if(a.password!==a.password_repeat)return n.auth.error(n.auth.texts.repeat_match,"password_repeat","#error-password");var i={old_password:a.old_password,new_password:a.password};n.auth.clear_error("#error-password"),$.ajax({type:"POST",url:"/auth/change_password",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){n.auth.success(n.auth.texts.password_updated,"#success-password"),$("#old_password").val(""),$("#password").val(""),$("#password_repeat").val("")}).fail(function(u){u.status===403?n.auth.error(n.auth.texts.invalid_password,null,"#error-password"):n.auth.error(n.auth.texts.ajax_error,null,"#error-password")})}if(e==="recover"){if(!a.username)return n.auth.error(n.auth.texts.please_username,"username");var i={username:a.username};n.auth.clear_error(),$.ajax({type:"POST",url:"/auth/recover",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){n.auth.success(n.auth.texts.sent_password_recovery),$("#username").val("")}).fail(function(u){u.status===403?n.auth.error(n.auth.texts.invalid_username):n.auth.error(n.auth.texts.ajax_error)})}if(e==="reset"){if(!a.password)return n.auth.error(n.auth.texts.please_password,"password");if(a.password.length<6)return n.auth.error(n.auth.texts.password_six,"password");if(a.password!==a.password_repeat)return n.auth.error(n.auth.texts.repeat_match,"password_repeat");var i={username:(o=n.auth.reset)===null||o===void 0?void 0:o.username,token:(s=n.auth.reset)===null||s===void 0?void 0:s.token,password:a.password};n.auth.clear_error(),$.ajax({type:"POST",url:"/auth/reset",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){n.auth.success(n.auth.texts.password_resetted),$("#password").val(""),$("#password_repeat").val(""),delete n.auth.reset,n.auth.redirect("login")}).fail(function(u){u.status===403?n.auth.error(n.auth.texts.invalid_reset_link):n.auth.error(n.auth.texts.ajax_error)})}},markAsTeacher:function(e,t){$.ajax({type:"POST",url:"/admin/markAsTeacher",data:JSON.stringify({username:e,is_teacher:t}),contentType:"application/json; charset=utf-8"}).done(function(){L.modal.alert(["User",e,"successfully",t?"marked":"unmarked","as teacher"].join(" "),4e3),location.reload()}).fail(function(r){console.log(r),L.modal.alert(["Error when",t?"marking":"unmarking","user",e,"as teacher"].join(" "))})},changeUserEmail:function(e,t){L.modal.prompt("Please enter the corrected email",t,function(r){if(r!==t){if(!r.match(n.auth.emailRegex))return L.modal.alert("Please enter a valid email.");$.ajax({type:"POST",url:"/admin/changeUserEmail",data:JSON.stringify({username:e,email:r}),contentType:"application/json; charset=utf-8"}).done(function(){L.modal.alert(["Successfully changed the email for User",e,"to",r].join(" ")),location.reload()}).fail(function(o){console.log(o),L.modal.alert(["Error when changing the email for User",e].join(" "))})}})}};$("#country")&&(ae=$("#country").html(),Object.keys(le).map(function(e){ae+='<option value="'+e+'">'+le[e]+"</option>"}),$("#country").html(ae));var ae;$(".auth input").get().map(function(e){e.addEventListener("input",function(){return n.auth.clear_error()})});$.ajax({type:"GET",url:"/profile"}).done(function(e){["/signup","/login"].indexOf(window.location.pathname)!==-1&&n.auth.redirect("my-profile"),n.auth.profile=e,$("#profile").html()&&($("#username").html(e.username),$("#email").val(e.email),$("#birth_year").val(e.birth_year),$("#gender").val(e.gender),$("#country").val(e.country),e.prog_experience&&($('input[name=has_experience][value="'+e.prog_experience+'"]').prop("checked",!0),e.prog_experience==="yes"&&$("#languages").show()),(e.experience_languages||[]).map(function(t){$('input[name=languages][value="'+t+'"]').prop("checked",!0)}),$("#student_classes ul").html((e.student_classes||[]).map(function(t){return"<li>"+n.auth.entityify(t.name)+"</li>"}).join("")))}).fail(function(e){window.location.pathname.indexOf("/my-profile")!==-1&&n.auth.redirect("login")});window.location.pathname==="/reset"&&(de=window.location.search.slice(1).split("&"),H={},de.map(function(e){var t=e.split("=");H[t[0]]=decodeURIComponent(t[1])}),!H.username||!H.token?n.auth.redirect("recover"):n.auth.reset=H);var de,H;window.location.pathname==="/signup"&&(z=localStorage.getItem("hedy-login-username"),z&&(localStorage.removeItem("hedy-login-username"),z.match("@")?$("#email").val(z):$("#username").val(z)));var z;$("#email, #mail_repeat").on("cut copy paste",function(e){return e.preventDefault(),!1});function ce(){return Ae(this,void 0,void 0,function(){var e,t,r,o,s,a;return Re(this,function(i){switch(i.label){case 0:return e=localStorage.getItem("hedy-first-save"),t=e?JSON.parse(e):void 0,t?[4,(0,Le.saveitP)(t[0],t[1],t[2],t[3])]:[3,2];case 1:if(i.sent(),localStorage.removeItem("hedy-first-save"),r=fe(),r)return[2,n.auth.redirect(r)];i.label=2;case 2:return o=localStorage.getItem("hedy-join"),s=o?JSON.parse(o):void 0,s?(localStorage.removeItem("hedy-join"),[2,(0,Ne.join_class)(s.link,s.name)]):(a=fe(),a?[2,n.auth.redirect(a)]:(n.auth.redirect("programs"),[2]))}})})}function fe(){var e=localStorage.getItem("hedy-save-redirect");return e&&localStorage.removeItem("hedy-save-redirect"),e}function he(e){var t=parseInt(e);return!(!t||t<1900||t>new Date().getFullYear())}});var W=A(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.get_trimmed_code=f.load_quiz=f.prompt_unsaved=f.copy_to_clipboard=f.share_program=f.viewProgramLink=f.saveitP=f.saveit=f.tryPaletteCode=f.runit=f.theGlobalEditor=void 0;ee();var h=J(),b=V();(function(){window.State||(window.State={}),s($("#editor"));for(var e=function(i){$(i).addClass("text-lg rounded");var d=a(i,!0);if(d.setOptions({maxLines:1/0}),d.setOptions({minLines:2}),d.setValue(d.getValue().replace(/\n+$/,""),-1),$(i).hasClass("no-copy-button")){if($(i).attr("id")){var l=String($(i).attr("id")),c=pe(parseInt(l));d.session.setMode(c)}}else{var u=$("<div>").css({position:"absolute",top:5,right:5,width:"auto"}).appendTo(i);$("<button>").attr("title",UiMessages.try_button).css({fontFamily:"sans-serif"}).addClass("green-btn").text("\u21E5").appendTo(u).click(function(){f.theGlobalEditor===null||f.theGlobalEditor===void 0||f.theGlobalEditor.setValue(d.getValue()+`
`)})}},t=0,r=$(".turn-pre-into-ace pre").get();t<r.length;t++){var o=r[t];e(o)}function s(i){if(!!i.length){var d=a(i.get(0),i.data("readonly"));f.theGlobalEditor=d,h.error.setEditor(d),window.Range=ace.require("ace/range").Range;var u=window.sessionStorage;if(u){var l=i.data("lskey"),c=i.data("loaded-program"),_=u.getItem(l);c!=="True"&&_&&d.setValue(_,1),d.on("blur",function(B){u.setItem(l,d.getValue())}),d.on("change",function(){$("#inline-modal").is(":visible")&&$("#inline-modal").hide(),window.State.disable_run=!1,$("#runit").css("background-color",""),window.State.unsaved_changes=!0,ge(d)})}window.onbeforeunload=function(){if(window.State.unsaved_changes&&!window.State.no_unload_prompt)return b.auth.texts.unsaved_changes};var O;return window.addEventListener("keydown",function(B){var F=B.keyCode;if(F===18){O=!0;return}if(F===13&&O){if(!window.State.level||!window.State.lang)throw new Error("Oh no");ve(window.State.level,window.State.lang,function(){$("#output").focus()})}F===37&&document.activeElement===document.getElementById("output")&&(d.focus(),d.navigateFileEnd())}),window.addEventListener("keyup",function(B){var F=B.keyCode;if(F===18){O=!1;return}}),d}}function a(i,d){var u=ace.edit(i);u.setTheme("ace/theme/monokai"),d&&u.setOptions({readOnly:!0,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1});var l=1;if(l==1&&window.State.level){var c=pe(parseInt(window.State.level));u.session.setMode(c)}return u}})();function pe(e){var t={"9":"ace/mode/level9and10","10":"ace/mode/level9and10","18":"ace/mode/level18and19","19":"ace/mode/level18and19"};return t[e]||"ace/mode/level"+e}function me(){return!b.auth.profile||b.auth.profile.session_expires_at>Date.now()?!1:(location.reload(),!0)}function ge(e){e.session.clearAnnotations();for(var t in e.session.getMarkers(!1))e.session.removeMarker(t)}function ve(e,t,r){if(window.State.disable_run)return h.modal.alert(b.auth.texts.answer_question);if(!me()){h.error.hide();try{e=e.toString();var o=f.theGlobalEditor,s=ne();ge(o),console.log(`Original program:
`,s),$.ajax({type:"POST",url:"/parse",data:JSON.stringify({level:e,code:s,lang:t,read_aloud:!!$("#speak_dropdown").val(),adventure_name:window.State.adventure_name}),contentType:"application/json",dataType:"json"}).done(function(a){if(console.log("Response",a),a.Warning&&h.error.showWarning(ErrorMessages.Transpile_warning,a.Warning),a.Error){h.error.show(ErrorMessages.Transpile_error,a.Error),a.Location&&a.Location[0]!="?"&&(o.session.setAnnotations([{row:a.Location[0]-1,column:a.Location[1]-1,text:"",type:"error"}]),o.session.addMarker(new ace.Range(a.Location[0]-1,a.Location[1]-1,a.Location[0]-1,a.Location[1]),"editor-error","fullLine",!1));return}Ue(a.Code,a.has_turtle,r).catch(function(i){console.log(i),h.error.show(ErrorMessages.Execute_error,i.message),Fe(e,s,i.message)})}).fail(function(a){console.error(a),a.readyState<4?h.error.show(ErrorMessages.Connection_error,ErrorMessages.CheckInternet):h.error.show(ErrorMessages.Other_error,ErrorMessages.ServerError)})}catch(a){console.error(a),h.error.show(ErrorMessages.Other_error,a.message)}}}f.runit=ve;function Be(e){var t=ace.edit("editor"),r=1;t.setValue(e+`
`,r),window.State.unsaved_changes=!1}f.tryPaletteCode=Be;function re(e,t,r,o,s){if(h.error.hide(),!me())try{if(!b.auth.profile)return h.modal.confirm(b.auth.texts.save_prompt,function(){window.State&&window.State.adventure_name&&!Array.isArray(e)&&(e=[e,window.State.adventure_name]),localStorage.setItem("hedy-first-save",JSON.stringify([e,t,r,o])),window.location.pathname="/login"});window.State.unsaved_changes=!1;var a=window.State.adventure_name;Array.isArray(e)&&(a=e[1],e=e[0]),$.ajax({type:"POST",url:"/programs",data:JSON.stringify({level:e,lang:t,name:r,code:o,adventure_name:a}),contentType:"application/json",dataType:"json"}).done(function(i){var d;if(s)return i.Error?s(i):s(null,i);if(i.Warning&&h.error.showWarning(ErrorMessages.Transpile_warning,i.Warning),i.Error){h.error.show(ErrorMessages.Transpile_error,i.Error);return}h.modal.alert(b.auth.texts.save_success_detail,4e3),$("#program_name").val(i.name),(d=window.State.adventures)===null||d===void 0||d.map(function(u){u.short_name===(a||"level")&&(u.loaded_program={name:i.name,code:o})})}).fail(function(i){console.error(i),h.error.show(ErrorMessages.Connection_error,JSON.stringify(i)),i.status===403&&(localStorage.setItem("hedy-first-save",JSON.stringify([a?[e,a]:e,t,r,o])),localStorage.setItem("hedy-save-redirect","hedy"),window.location.pathname="/login")})}catch(i){console.error(i),h.error.show(ErrorMessages.Other_error,i.message)}}f.saveit=re;function De(e,t,r,o){return new Promise(function(s,a){re(e,t,r,o,function(i,d){i?a(i):s(d)})})}f.saveitP=De;function we(e){return window.location.origin+"/hedy/"+e+"/view"}f.viewProgramLink=we;function Je(e,t,r,o,s){if(!b.auth.profile)return h.modal.alert(b.auth.texts.must_be_logged);var a=function(u){$.ajax({type:"POST",url:"/programs/share",data:JSON.stringify({id:u,public:o}),contentType:"application/json",dataType:"json"}).done(function(l){o&&_e(we(u),!0),h.modal.alert(o?b.auth.texts.share_success_detail:b.auth.texts.unshare_success_detail,4e3),s&&setTimeout(function(){location.reload()},1e3)}).fail(function(l){console.error(l),h.error.show(ErrorMessages.Connection_error,JSON.stringify(l))})};if(r!==!0)return a(r);var i=""+$("#program_name").val(),d=ne();return re(e,t,i,d,function(u,l){if(u&&u.Warning)return h.error.showWarning(ErrorMessages.Transpile_warning,u.Warning);if(u&&u.Error)return h.error.show(ErrorMessages.Transpile_error,u.Error);a(l.id)})}f.share_program=Je;function _e(e,t){var r,o,s=document.createElement("textarea");s.value=e,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s);var a=document.getSelection(),i=a&&a.rangeCount>0?a.getRangeAt(0):void 0;s.select(),document.execCommand("copy"),document.body.removeChild(s),i&&((r=document.getSelection())===null||r===void 0||r.removeAllRanges(),(o=document.getSelection())===null||o===void 0||o.addRange(i)),t||h.modal.alert(b.auth.texts.copy_clipboard,4e3)}f.copy_to_clipboard=_e;function Fe(e,t,r){$.ajax({type:"POST",url:"/report_error",data:JSON.stringify({level:e,code:t,page:window.location.href,client_error:r}),contentType:"application/json",dataType:"json"})}window.onerror=function(t,r,o,s,a){$.ajax({type:"POST",url:"/client_exception",data:JSON.stringify({message:t,source:r,line_number:o,column_number:s,error:a,url:window.location.href,user_agent:navigator.userAgent}),contentType:"application/json",dataType:"json"})};function Ue(e,t,r){window.State.programsInExecution||(window.State.programsInExecution=0),window.State.programsInExecution++;var o=$("#output");o.empty(),Sk.pre="output";var s=Sk.TurtleGraphics||(Sk.TurtleGraphics={});return s.target="turtlecanvas",s.width=400,s.height=300,s.worldWidth=400,s.worldHeight=300,t||$("#turtlecanvas").empty(),Sk.configure({output:d,read:u,inputfun:l,inputfunTakesPrompt:!0,__future__:Sk.python3,timeoutMsg:function(){return ErrorMessages.Program_too_long},execLimit:function(){return t?2e4:3e3}()}),Sk.misceval.asyncToPromise(function(){return Sk.importMainWithBody("<stdin>",!1,e,!0)}).then(function(c){console.log("Program executed"),window.State.programsInExecution===1&&$("#output").is(":empty")&&$("#turtlecanvas").is(":empty")&&h.error.showWarning(ErrorMessages.Transpile_warning,ErrorMessages.Empty_output),window.State.programsInExecution--,r&&r()}).catch(function(c){console.log(c);var _=a(c)||JSON.stringify(c);throw new Error(_)});function a(c){var _=c.args&&c.args.v&&c.args.v[0]&&c.args.v[0].v;return _}function i(c,_){$("<span>").text(c).css({color:_}).appendTo(o)}function d(c){window.State.programsInExecution>1||(i(c,"white"),ye(c))}function u(c){if(Sk.builtinFiles===void 0||Sk.builtinFiles.files[c]===void 0)throw"File not found: '"+c+"'";return Sk.builtinFiles.files[c]}function l(c){return Sk.execStart=new Date(new Date().getTime()+1e3*60*60*24*365),$("#turtlecanvas").empty(),new Promise(function(_){window.State.disable_run=!0,$("#runit").css("background-color","gray");var O=$('#inline-modal input[type="text"]');$("#inline-modal .caption").text(c),O.val(""),O.attr("placeholder",c),ye(c),setTimeout(function(){O.focus()},0),$("#inline-modal form").one("submit",function(B){return window.State.disable_run=!1,$("#runit").css("background-color",""),B.preventDefault(),$("#inline-modal").hide(),Sk.execStart=new Date,setTimeout(function(){_(O.val()),$("#output").focus()},0),!1}),$("#inline-modal").show()})}}function ye(e){var t=$("#speak_dropdown").val();if(!!t){var r=window.speechSynthesis.getVoices().filter(function(s){return s.voiceURI===t})[0];if(r){var o=new SpeechSynthesisUtterance(e);o.voice=r,o.rate=.9,speechSynthesis.speak(o)}}}(function(){if(!window.speechSynthesis||!window.State.lang)return;var e=0,t=setInterval(function(){var o;e+=1;var s=r((o=window.State.lang)!==null&&o!==void 0?o:"");if(s.length>0){for(var a=0,i=s;a<i.length;a++){var d=i[a];$("#speak_dropdown").append($("<option>").attr("value",d.voiceURI).text("\u{1F4E3} "+d.name))}$("#speak_container").show(),clearInterval(t)}e>=20&&clearInterval(t)},100);function r(o){var s=o.match(/^([a-z]+)/i);if(!s)return[];var a=s[1];return window.speechSynthesis?window.speechSynthesis.getVoices().filter(function(i){return i.lang.startsWith(a)}):[]}})();function Ve(e){if(!window.State.unsaved_changes)return e();window.State.no_unload_prompt=!0,h.modal.confirm(b.auth.texts.unsaved_changes,e)}f.prompt_unsaved=Ve;function He(e){$('*[data-tabtarget="end"]').html('<iframe id="quiz-iframe" class="w-full" title="Quiz" src="/quiz/start/'+e+'"></iframe>')}f.load_quiz=He;function ne(){try{var e=ace.require("ace/ext/whitespace");e.trimTrailingSpace(f.theGlobalEditor.session,!0)}catch(t){console.error(t)}return f.theGlobalEditor===null||f.theGlobalEditor===void 0?void 0:f.theGlobalEditor.getValue()}f.get_trimmed_code=ne});var Se=A(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});var ze=J(),Ke=V(),S=W();$(function(){function e(){$("#warningbox").hide(),$("#errorbox").hide(),$("#output").empty(),$("#turtlecanvas").empty(),window.State.unsaved_changes=!1}function t(o){var s,a,i=$('*[data-tab="'+o+'"]'),d=i.siblings("*[data-tab]"),u=$('*[data-tabtarget="'+o+'"]'),l=u.siblings("*[data-tabtarget]");d.removeClass("tab-selected"),i.addClass("tab-selected"),l.addClass("hidden"),u.removeClass("hidden");var c={};if((s=window.State.adventures)===null||s===void 0||s.map(function(_){c[_.short_name]=_}),e(),o==="end"){$("#adventures-tab").css("max-height","100%"),$("#level-header input").hide(),$("#editor-area").hide();return}$("#adventures-tab").css("max-height","20em"),$("#level-header input").show(),$("#editor-area").show(),window.State.loaded_program&&(window.State.adventure_name_onload||"level")===o?($("#program_name").val(window.State.loaded_program.name),S.theGlobalEditor===null||S.theGlobalEditor===void 0||S.theGlobalEditor.setValue(window.State.loaded_program.code)):((a=c[o])===null||a===void 0?void 0:a.loaded_program)?($("#program_name").val(c[o].loaded_program.name),S.theGlobalEditor===null||S.theGlobalEditor===void 0||S.theGlobalEditor.setValue(c[o].loaded_program.code)):o==="level"&&window.State.default_program_name&&window.State.default_program?($("#program_name").val(window.State.default_program_name),S.theGlobalEditor===null||S.theGlobalEditor===void 0||S.theGlobalEditor.setValue(window.State.default_program)):($("#program_name").val(c[o].default_save_name+" - "+window.State.level_title+" "+window.State.level),S.theGlobalEditor===null||S.theGlobalEditor===void 0||S.theGlobalEditor.setValue(c[o].start_code)),window.State.adventure_name=o==="level"?void 0:o,S.theGlobalEditor===null||S.theGlobalEditor===void 0||S.theGlobalEditor.clearSelection(),window.State.unsaved_changes=!1}if($("*[data-tab]").click(function(o){var s=$(o.target),a=s.data("tab");o.preventDefault(),window.State.unsaved_changes?ze.modal.confirm(Ke.auth.texts.unsaved_changes,function(){return t(a)}):t(a);var i=a!=="level"?a:"";window.history&&window.history.replaceState(null,"","#"+i)}),window.State&&window.State.adventure_name)t(window.State.adventure_name);else if(window.location.hash){var r=window.location.hash.replace(/^#/,"");r&&t(r)}})});var ke=A(()=>{"use strict";function We(e){var t=80,r=e.split(`
`),o=r.map(function(s){return Math.floor(s.length/t)});return qe(o)+r.length}function qe(e){for(var t=0,r=0,o=e;r<o.length;r++){var s=o[r];t+=s}return t}function be(e){var t=Math.max(1,We($(e).val())),r=t*25+4;$(e).height()<r&&$(e).css({height:r+"px"})}$("textarea").each(function(e,t){return be(t)}).on("input",function(e){var t=$(e.target);t.hasClass("touched")||(t.addClass("touched"),t.attr("name",t.data("name")),Ze(t.closest("form"))),be(t)});var $e=new Map;function Ze(e){var t=e.data("file"),r=$e.get(t);if(!r){var o=$('button[data-file="'+t+'"]');r={button:o,changes:0},$e.set(t,r)}r.changes+=1,r.button.text(t+" ("+r.changes+")")}$("button[data-file]").click(function(e){var t=$(e.target).data("file"),r=$('form[data-file="'+t+'"]');r.submit()})});var Qe=A(G=>{"use strict";var Ye=G&&G.__createBinding||(Object.create?function(e,t,r,o){o===void 0&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){o===void 0&&(o=r),e[o]=t[r]}),q=G&&G.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&Ye(t,e,r)};Object.defineProperty(G,"__esModule",{value:!0});q(J(),G);q(W(),G);q(V(),G);ee();Se();ke();q(te(),G)});return Qe();})();
//# sourceMappingURL=appbundle.js.map
